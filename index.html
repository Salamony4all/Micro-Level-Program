<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Micro-Level Program</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        body {
            background-color: #020817;
            color: #e2e8f0;
        }
        .table-container {
            background-color: #0f172a;
            border-radius: 0.5rem;
            padding: 1.5rem;
            border: 1px solid #1e293b;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 1rem 1.5rem;
            text-align: left;
            border-bottom: 1px solid #1e293b;
        }
        th {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #94a3b8;
        }
        tr:last-child td {
            border-bottom: none;
        }
        .status-pill {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        .status-paid { background-color: #166534; color: #dcfce7; }
        .status-pending { background-color: #f59e0b; color: #fffbeb; }
        .status-overdue { background-color: #b91c1c; color: #fee2e2; }

        input, select {
            background-color: #1e293b;
            border: 1px solid #334155;
            color: #e2e8f0;
            border-radius: 0.375rem;
            padding: 0.5rem 0.75rem;
            width: 100%;
        }
        .flatpickr-calendar {
            background: #0f172a;
            border: 1px solid #1e293b;
        }
        .flatpickr-day { color: #e2e8f0; }
        .flatpickr-day.selected { background: #64748b; border-color: #64748b; }
        .flatpickr-day:hover { background: #334155; }
        .flatpickr-months .flatpickr-month, .flatpickr-current-month .flatpickr-monthDropdown-months { color: #e2e8f0; }
        .numInput, .arrowUp, .arrowDown { color: #e2e8f0 !important; }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: background-color 0.2s;
            cursor: pointer;
            border: 1px solid transparent;
        }
        .btn-primary {
            background-color: #fafafa;
            color: #020817;
            border-color: #e5e5e5;
        }
        .btn-primary:hover {
            background-color: #f4f4f5;
        }
        .btn-ghost {
             background-color: transparent;
             color: #fafafa;
             border-color: #334155;
        }
        .btn-ghost:hover {
            background-color: #334155;
        }
        .btn-destructive {
            background-color: #ef4444;
            color: #fafafa;
        }
         .btn-destructive:hover {
            background-color: #dc2626;
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8">
    <div class="max-w-7xl mx-auto">
        <header class="flex items-center justify-between mb-6">
            <div>
                <h1 class="text-2xl font-bold tracking-tight">Project Invoices</h1>
                <p class="text-slate-400">Manage and track all your project invoices.</p>
            </div>
            <div class="flex items-center gap-2">
                <button id="download-pdf-btn" class="btn btn-ghost">Download as PDF</button>
                <button id="download-csv-btn" class="btn btn-ghost">Download as CSV</button>
                <button id="add-row-btn" class="btn btn-primary">Add Invoice</button>
            </div>
        </header>
        <div class="table-container">
            <table id="invoice-table">
                <thead>
                    <tr>
                        <th>Client</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Due Date</th>
                        <th class="text-right">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Table rows will be inserted here by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
    <script>
        const initialData = [
            { id: 1, client: "Stripe", amount: 250.00, status: "Paid", dueDate: "2024-03-15" },
            { id: 2, client: "Google", amount: 500.00, status: "Pending", dueDate: "2024-04-01" },
            { id: 3, client: "Vercel", amount: 150.00, status: "Paid", dueDate: "2024-02-28" },
            { id: 4, client: "GitHub", amount: 75.00, status: "Overdue", dueDate: "2024-03-01" },
            { id: 5, client: "Netflix", amount: 300.00, status: "Pending", dueDate: "2024-04-10" },
        ];
        
        let tableData = [...initialData];
        let nextId = tableData.length + 1;
        
        const tableBody = document.querySelector("#invoice-table tbody");

        function renderTable() {
            tableBody.innerHTML = "";
            tableData.forEach(row => {
                const tr = document.createElement("tr");
                tr.dataset.id = row.id;
                tr.innerHTML = getRowHtml(row);
                tableBody.appendChild(tr);
                attachRowEventListeners(tr, row);
            });
        }
        
        function getRowHtml(row) {
            const statusClasses = {
                Paid: 'status-paid',
                Pending: 'status-pending',
                Overdue: 'status-overdue',
            };
            return `
                <td><input type="text" class="client" value="${row.client}"></td>
                <td><input type="number" step="0.01" class="amount" value="${row.amount.toFixed(2)}"></td>
                <td>
                    <select class="status">
                        <option value="Paid" ${row.status === 'Paid' ? 'selected' : ''}>Paid</option>
                        <option value="Pending" ${row.status === 'Pending' ? 'selected' : ''}>Pending</option>
                        <option value="Overdue" ${row.status === 'Overdue' ? 'selected' : ''}>Overdue</option>
                    </select>
                </td>
                <td><input type="text" class="due-date" value="${row.dueDate}"></td>
                <td class="text-right">
                    <button class="btn btn-destructive delete-btn">Delete</button>
                </td>
            `;
        }
        
        function attachRowEventListeners(tr, rowData) {
            flatpickr(tr.querySelector('.due-date'), { dateFormat: 'Y-m-d' });

            tr.querySelector('.client').addEventListener('change', (e) => updateRowData(rowData.id, 'client', e.target.value));
            tr.querySelector('.amount').addEventListener('change', (e) => updateRowData(rowData.id, 'amount', parseFloat(e.target.value)));
            tr.querySelector('.status').addEventListener('change', (e) => updateRowData(rowData.id, 'status', e.target.value));
            tr.querySelector('.due-date').addEventListener('change', (e) => updateRowData(rowData.id, 'dueDate', e.target.value));
            
            tr.querySelector('.delete-btn').addEventListener('click', () => {
                tableData = tableData.filter(r => r.id !== rowData.id);
                renderTable();
            });
        }

        function updateRowData(id, key, value) {
            const rowIndex = tableData.findIndex(r => r.id === id);
            if (rowIndex > -1) {
                tableData[rowIndex][key] = value;
            }
        }

        document.getElementById('add-row-btn').addEventListener('click', () => {
            const newRow = { id: nextId++, client: "", amount: 0, status: "Pending", dueDate: new Date().toISOString().split('T')[0] };
            tableData.push(newRow);
            const tr = document.createElement("tr");
            tr.dataset.id = newRow.id;
            tr.innerHTML = getRowHtml(newRow);
            tableBody.appendChild(tr);
            attachRowEventListeners(tr, newRow);
        });

        document.getElementById('download-pdf-btn').addEventListener('click', () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.autoTable({
                head: [['Client', 'Amount', 'Status', 'Due Date']],
                body: tableData.map(row => [row.client, `$${row.amount.toFixed(2)}`, row.status, row.dueDate]),
                startY: 20,
                headStyles: { fillColor: [22, 163, 74] },
            });
            doc.text("Project Invoices", 14, 15);
            doc.save('invoices.pdf');
        });

        document.getElementById('download-csv-btn').addEventListener('click', () => {
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Client,Amount,Status,DueDate\n";
            tableData.forEach(row => {
                csvContent += `${row.client},${row.amount},${row.status},${row.dueDate}\n`;
            });
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "invoices.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });

        // Initial render
        renderTable();
    </script>
</body>
</html>
